---
title: "03 Verilog HDL 程序设计语句和描述方式"
date: 2022-11-06T11:33:02+08:00
draft: false
weight: 3
---

## 数据流建模

- 在数字电路中，输入信号经过组合逻辑电路传到输出时类似于数据流动，而不会在其中存储
- 可以通过连续赋值语句对这种特性进行建模
- 只有一种描述方式：即通过连续赋值语句进行逻辑描述，由`assign`引导
- 对于连续赋值语句，只要输入端操作数的值发生变化，该语句就重新计算并刷新赋值结果
- 连续赋值语句只能用来对连线型变量进行驱动，而不能对寄存器型变量进行赋值
- 显式连续赋值语句，定义和赋值在两条语句，尽量用显式

```verilog
assign #<delay><name> = assignment expression
```

- 隐式连续赋值语句，定义和赋值在一条语句

```verilog
<net_declaration><drive_strength><arnge>#<delay><name> = assignment expression
```

 ![image-20221106114851794](C:\Users\杨云召\AppData\Roaming\Typora\typora-user-images\image-20221106114851794.png)

 ![image-20221106114930680](C:\Users\杨云召\AppData\Roaming\Typora\typora-user-images\image-20221106114930680.png)

### 注意事项

- 赋值目标只能是线网类型
- 只要右边表达式任何一个变量有变化，表达式立即被计算，计算结果立即赋给左边信号
- 连续赋值语句不能出现在过程块中
- 多个连续赋值语句之间是并行关系，因此与位置顺序无关
- 连续赋值语句中的延时具有硬件电路中惯性延时的特性，任何小于其延时量的信号变化脉冲都将被过滤掉，不会出现在输出端口

## 行为级建模

- 从电路外部行为的角度对其进行描述，它是为了综合和仿真而进行的
- 通常用于复杂数字逻辑系统的顶层设计中，通过行为级建模把一个复杂的系统分解成可操作的若干个子模块。每个模块之间的逻辑关系通过行为模块的仿真加以验证
- 同时行为级建模也可以用来生成仿真测试信号，对已设计的模块进行检测

 ![image-20221106192305153](https://nas.znmlr.cn:15900/markdown/2022/11/image-20221106192305153.png)

 ![image-20221106192337970](https://nas.znmlr.cn:15900/markdown/2022/11/image-20221106192337970.png)

### 过程语句

#### initial语句

 ![image-20221106192904668](https://nas.znmlr.cn:15900/markdown/2022/11/image-20221106192904668.png)

- initial过程块在进行仿真时从模拟0时刻开始执行，只执行一次，在执行完一次后该initial被挂起不再执行。
- 如果一个模块中存在多个initial过程块，则每个initial都同时从0时刻开始并行执行的
- initial内的多条行为语句可以是顺序执行的，也可以是并行执行的

#### always语句

- always语句的触发状态是一直存在的，只要满足always后面的敏感事件列表，就执行语句块

```verilog
always@(<敏感事件列表>)
	语句块;	
```

 ![image-20221106194056936](https://nas.znmlr.cn:15900/markdown/2022/11/image-20221106194056936.png)

```verilog
@(a or b)
// 等价于
@(a, b)
```

#### 过程语句使用中的注意事项

- 无论是对时序逻辑电路还是对组合逻辑电路进行描述，Verilog HDL要求在过程语句中，被赋值信号必须定义为reg类型
- 敏感事件表有设计要求

> - 对组合电路进行描述时：需要把全部的输入信号列入敏感事件表
> - 对时序电路进行描述时：需要把时间信号和部分输入信号列入敏感事件列表

### 语句块

- 包括串行语句块(`begin-end`)和并行语句块(`fork-join`)

> - 串行语句块用于可综合电路程序和仿真测试程序
> - 串行语句块中的每条语句依据块中的排列次序逐条执行，每条语句给出的延迟时间都是相对于前一条语句执行结束的相对时间
> - 串行语句块的起始执行时间就是第一条语句的开始执行时间。串行语句块的结束时间就是块最后一条语句执行结束的时间

> - 并行语句块只能用于仿真测试程序，不能用于可综合电路程序
>
> - 块内语句是同时执行的，即程序流程控制一进入到该并行语句块，块内语句则同时开始执行
> - 块内每条语句的延迟时间是相对于程序流程控制进入块内的仿真时间

 ![image-20221106213901094](https://nas.znmlr.cn:15900/markdown/2022/11/image-20221106213901094.png)

### 过程赋值语句

- 过程块中的赋值语句称为过程赋值语句，过程性赋值是在initial或always中的赋值
- 它只能对寄存器数据类型的变量赋值

#### 阻塞性赋值语句

```verilog
b = a;
```

- 当一个语句块中有多条阻塞性赋值语句时，前一条没有完成，后面的不会执行
- 在串行语句块中，每条阻塞赋值语句将按照排列顺序一次执行；在并行语句块中，每条阻塞赋值语句同时执行，没有先后之分
- 执行阻塞赋值语句的顺序：先计算等号右侧表达式的值，然后立刻将计算的值赋给左边的变量，与仿真时间无关

#### 非阻塞性赋值语句

```verilog
b <= a;
```

- 如果一个语句块中有多条非阻塞赋值语句，则后面语句的执行不会受到前面语句的限制
- 在串行语句块中，每条非阻塞赋值语句的执行没有先后之分，并行执行
- 执行非阻塞赋值语句的顺序：先计算等号右侧表达式的值，然后等延迟时间结束，再将计算的值赋给左边的变量

```verilog
// 程序1阻塞性赋值
module block1(din, clk, out1, out2);
    input din, clk;
    output out1, out2;
    reg out1, out2;
    always@(posedge clk)
        begin
            out1 = din;
            out2 = out1;
        end
endmodule

// 程序2非阻塞性赋值 
module block1(din, clk, out1, out2);
    input din, clk;
    output out1, out2;
    reg out1, out2;
    always@(posedge clk)
        begin
            out1 <= din;
            out2 <= out1;
        end
endmodule
```

 ![image-20221106215220365](https://nas.znmlr.cn:15900/markdown/2022/11/image-20221106215220365.png)

 ![image-20221106215232112](https://nas.znmlr.cn:15900/markdown/2022/11/image-20221106215232112.png)

### 过程连续赋值语句

- 过程连续赋值可以在`always`和`initial`过程语句中对连线型和寄存器型变量类型进行赋值操作
- 有两种列席：赋值`assign`、重新赋值`deassign`和强制`force`、释放`release`
- 过程连续赋值不能对寄存器型变量进行位操作，例如`assign c[1] = 1;`是错误的
- 一般用于测试、仿真中

#### 赋值与重新赋值语句

- 只能对寄存器类型变量
- 使用`assign`给寄存器型变量赋值后，该值将一直保持在这个寄存器上，直到`deassign`

#### 强制语句和释放语句

- 优先级高于`assign`
- 可以对连线型和寄存器型变量操作

### 条件分支语句

#### if语句

 ![image-20221107211324146](https://nas.znmlr.cn:15900/markdown/2022/11/image-20221107211324146.png)

 ![image-20221107211805687](https://nas.znmlr.cn:15900/markdown/2022/11/image-20221107211805687.png)

- 若为`0`、`z`、`x`，按假处理，为`1`按真处理

#### case语句

- 可以描述真值表、有限状态机

 ![image-20221107211943699](https://nas.znmlr.cn:15900/markdown/2022/11/image-20221107211943699.png)

 ![image-20221107212251557](https://nas.znmlr.cn:15900/markdown/2022/11/image-20221107212251557.png)

- 值1到值n必须各不相同
- 如果某几个连续排列的值项执行的是同一条语句，则这几个值项间可以用逗号间隔，而将语句放在这几个值项的最后一项中
- default不是必须的
- case语句的所有表达式的值得位宽必须相等

 ![image-20221107212538132](https://nas.znmlr.cn:15900/markdown/2022/11/image-20221107212538132.png)

 ![image-20221107212552222](https://nas.znmlr.cn:15900/markdown/2022/11/image-20221107212552222.png)

### 循环语句

循环语句可以用于可综合电路的设计

#### foreve语句

- 永久循环，直到遇到系统任务`$finish`
- 一般用在`initial`过程语句中

#### repeat语句

- 执行固定次数的循环

```verilog
repeat(循环次数表达式)
    语句或语句块;
```

- 循环次数表达式：用于指定循环次数，是一个常量、变量或信号。如果是变量或者信号，它是循环开始执行时变量或者信号的值，而不是循环执行期间的值

#### while语句

- 与**C**类似

#### for语句

- 与**C**类似

## 结构化建模

