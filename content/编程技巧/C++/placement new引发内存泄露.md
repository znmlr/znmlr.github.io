---
title: "Placement New引发内存泄露"
date: 2022-10-17T23:49:38+08:00
draft: false
weight: 1
---

- 只要用到了模板库中的模板类，都会出现内存泄漏问题。原来问题就出在了模板类上。这到底是怎么回事。
- 查来查去，网上查阅了多方资料，终于得出了结论：
- 原来，对于类对象的基础类型成员来说，基础类型所需要的内存空间大小始终是原先的那块空间那么大，无论如何都跳不开那块空间，无论它怎么初始化，怎么构造，都还是在原来的空间上去赋值，所以没啥问题。
- 然而，对于`std`标准库中的模板类，它们自带有一套内存分配手段。我们以`std::string`为例来描述。`std::string`它会在内存空间中预先申请额外的空间去存放接下来的每一个字符，如果`append`进去的字符超出了他的长度，那么它会去重新申请一块空间去存放当前的所有字符，旧的那些字符会一个个复制到新申请的内存空间中，然后析构掉旧的空间。
- 我们持有的一个`std::string`的变量，其实是另一个对象，它内部维护了它真实的字符串内存，而它自己则相当于其内部字符串空间的一个地址别名而已。
